# -*- coding: utf-8 -*-
"""EDA.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ec-bcwKUXFFxf0ADa2X_l0ds1DxrYSmK
"""

# ==============================
# ğŸ“Š CSV íŒŒì¼ìš© ìë™ EDA ì½”ë“œ (Colab í•œê¸€ ì™„ë²½ í˜¸í™˜)
# ==============================
import matplotlib.font_manager as fm
import matplotlib.pyplot as plt
import matplotlib as mpl
import glob

import seaborn as sns
import pandas as pd
import numpy as np


# ==============================
# 1ï¸âƒ£ CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
# ==============================
df = pd.read_csv("/content/drive/MyDrive/á„€á…µá„€á…¨á„’á…¡á†¨á„‰á…³á†¸/á„á…µá†·á„‘á…³á†¯/Data/POS_all.csv", encoding='utf-8')

# ==============================
# 2ï¸âƒ£ ë°ì´í„° ì „ì²˜ë¦¬
# ==============================
# 'ì˜ì—…ì¼ì'ë¥¼ datetimeìœ¼ë¡œ ë³€í™˜
df['ì˜ì—…ì¼ì'] = pd.to_datetime(df['ì˜ì—…ì¼ì'], errors='coerce')

# 'ì¼ë§¤ì¶œ', 'ê°ë‹¨ê°€'ë¥¼ ìˆ«ìë¡œ ë³€í™˜ (ì‰¼í‘œ, ê³µë°± ì œê±°)
for col in ['ì¼ë§¤ì¶œ', 'ê°ë‹¨ê°€']:
    df[col] = df[col].astype(str).str.replace(',', '').str.strip()
    df[col] = pd.to_numeric(df[col], errors='coerce')

# ê²°ì¸¡ ì œê±°
df = df.dropna(subset=['ì˜ì—…ì¼ì'])

# ì—°ë„, ì›”, ì¼ ì¶”ê°€
df['ì—°ë„'] = df['ì˜ì—…ì¼ì'].dt.year
df['ì›”'] = df['ì˜ì—…ì¼ì'].dt.month
df['ì¼'] = df['ì˜ì—…ì¼ì'].dt.day

# ==============================
# 3ï¸âƒ£ ì—°ë„ë³„ ì§‘ê³„ (xì¶•: ì›”)
# ==============================
yearly_sales = df.groupby(['ì—°ë„', 'ì›”'], as_index=False)[['ì¼ë§¤ì¶œ', 'ë§¤ì¶œê±´ìˆ˜']].sum()

# ==============================
# 4ï¸âƒ£ ì›”ë³„ ì§‘ê³„ (xì¶•: ë‚ ì§œ)
# ==============================
# ìµœì‹  ì—°ë„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° í•„í„°ë§
latest_year = df['ì—°ë„'].max()

# ==============================
# 5ï¸âƒ£ ì‹œê°í™”
# ==============================

plt.figure(figsize=(12, 6))
sns.lineplot(data=yearly_sales, x='ì›”', y='ì¼ë§¤ì¶œ', hue='ì—°ë„', marker='o')
plt.title('ì—°ë„ë³„ ì›”í‰ê·  ì¼ë§¤ì¶œ ì¶”ì´')
plt.xlabel('ì›”')
plt.ylabel('ì¼ë§¤ì¶œ')
plt.legend(title='ì—°ë„')
plt.show()

plt.figure(figsize=(12, 6))
sns.lineplot(data=yearly_sales, x='ì›”', y='ë§¤ì¶œê±´ìˆ˜', hue='ì—°ë„', marker='o')
plt.title('ì—°ë„ë³„ ì›”ë³„ ë§¤ì¶œê±´ìˆ˜ ì¶”ì´')
plt.xlabel('ì›”')
plt.ylabel('ë§¤ì¶œê±´ìˆ˜')
plt.legend(title='ì—°ë„')
plt.show()

# ==============================
# 3ï¸âƒ£ ì›”ë³„ í•©ê³„ ë°ì´í„° (ì—°ë„ë³„)
# ==============================
monthly_summary = (
    df.groupby(['ì—°ë„', 'ì›”'], as_index=False)[['ì¼ë§¤ì¶œ', 'ë§¤ì¶œê±´ìˆ˜']]
    .sum()
    .sort_values(['ì—°ë„', 'ì›”'])
)

# ==============================
# 4ï¸âƒ£ ê·¸ë˜í”„ ì‹œê°í™” (3í–‰ 2ì—´: ì—°ë„ë³„ ë¬¶ìŒ)
# ==============================

years = sorted(df['ì—°ë„'].unique())
sns.set_style("whitegrid")

fig, axes = plt.subplots(len(years), 2, figsize=(14, 5 * len(years)))

for i, year in enumerate(years):
    sub = monthly_summary[monthly_summary['ì—°ë„'] == year]

    # (ì™¼ìª½) ì¼ë§¤ì¶œ
    sns.lineplot(data=sub, x='ì›”', y='ì¼ë§¤ì¶œ', marker='o', ax=axes[i, 0], color='tab:blue')
    axes[i, 0].set_title(f"{year}ë…„ ì›”ë³„ ì¼ë§¤ì¶œ ì¶”ì´", fontsize=13)
    axes[i, 0].set_xlabel("ì›”")
    axes[i, 0].set_ylabel("ì¼ë§¤ì¶œ")
    axes[i, 0].grid(True)

    # (ì˜¤ë¥¸ìª½) ë§¤ì¶œê±´ìˆ˜
    sns.lineplot(data=sub, x='ì›”', y='ë§¤ì¶œê±´ìˆ˜', marker='o', ax=axes[i, 1], color='tab:orange')
    axes[i, 1].set_title(f"{year}ë…„ ì›”ë³„ ë§¤ì¶œê±´ìˆ˜ ì¶”ì´", fontsize=13)
    axes[i, 1].set_xlabel("ì›”")
    axes[i, 1].set_ylabel("ë§¤ì¶œê±´ìˆ˜")
    axes[i, 1].grid(True)

plt.tight_layout()
plt.show()

# âœ… 1. ë‚˜ëˆ” í°íŠ¸ ì„¤ì¹˜
!apt-get update -qq
!apt-get install -qq fonts-nanum

# âœ… 2. Matplotlibì— í°íŠ¸ ìˆ˜ë™ ë“±ë¡
import matplotlib.font_manager as fm
import matplotlib.pyplot as plt
import matplotlib as mpl
import glob

# Colabì— ì„¤ì¹˜ëœ ë‚˜ëˆ”í°íŠ¸ ê²½ë¡œ ì°¾ê¸°
font_paths = glob.glob("/usr/share/fonts/truetype/nanum/*.ttf")
for path in font_paths:
    fm.fontManager.addfont(path)

# âœ… 3. í°íŠ¸ ì„¤ì • ì ìš©
plt.rc('font', family='NanumGothic')
mpl.rcParams['axes.unicode_minus'] = False

# âœ… 4. í…ŒìŠ¤íŠ¸
plt.title("ğŸ‰ í•œê¸€ í°íŠ¸ ë“œë””ì–´ ì˜ ë‚˜ì˜¨ë‹¤!")
plt.plot([1, 2, 3], [1, 4, 9])
plt.show()